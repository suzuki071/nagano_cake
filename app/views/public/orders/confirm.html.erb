<div class="container my-4">
  <div class="row">
    <div class="offset-col-md-2 col-md-8 my-3 mx-3">
      <h4>注文情報入力</h4>
    </div>
  </div>

  <div class="row">
    <div class="col-md-9">
      <% if current_customer.cart_items.present? %>
      <table class="table table-bordered border-dark">
        <thead>
          <tr>
            <th class="table-active border border-dark">商品名</th>
            <th class="table-active border border-dark">単価（税込）</th>
            <th class="table-active border border-dark">数量</th>
            <th class="table-active border border-dark">小計</th>
          </tr>
        </thead>
        <tbody>
        <% all_price = 0 %>
        <% @cart_items.each do |cart| %>
          <tr>
            <td class="border border-dark">
              <%= attachment_image_tag(cart.item, :image, size: "60x50", fallback: "no_image.jpg") %>
              <%= cart.item.name %>
            </td>
            <td class="border border-dark">
              ¥<%= (cart.item.price).to_s(:delimited) %>
            </td>
            <td class="border border-dark"><%= cart.amount %></td>
            <% item_price = (cart.amount).to_i * cart.item.price %>
            <td class="border border-dark"><%= item_price.to_s(:delimited) %></td>
            <% all_price += item_price %>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
    <div class="col-md-3">
      <table class="table table-bordered border-dark">
        <tr>
          <th class="table-active border border-dark">送料</th>
          <% @order.shipping_cost = '700' %>
          <td class="border border-dark"><%= @order.shipping_cost %></td>
        </tr>
        <tr>
          <th class="table-active border border-dark">商品合計</th>
          <td class="border border-dark"><%= all_price.to_s(:delimited) %></td>
        </tr>
        <tr>
          <% all_payment = 0 %>
          <th class="table-active border border-dark">請求金額</th>
          <% all_payment = (all_price).to_i + (@order.shipping_cost).to_i %>
          <td class="border border-dark"><%= all_payment.to_s(:delimited) %></td>
          <!-- (all_price + @order.shipping_cost).to_s(:delimited) -->
        </tr>
      </table>
    </div>

  </div>

  <div class="pb-4">
    <strong>支払方法</strong>
    <span class="pl-3"><%= @order.payment_method %></span>
  </div>
  <div>
    <strong>お届け先</strong>
    <span class="pl-3"><%= "#{@order.postal_code} #{@order.address} #{@order.name}" %></span>
  </div>

  <div class ="col-xs-11 text-center mt-5">
    <%= form_with model:@order, url:definition_orders_path, method: :post, local: true do |f| %>
      <%= f.hidden_field :postal_code %>
      <%= f.hidden_field :address %>
      <%= f.hidden_field :name %>
      <%= f.hidden_field :payment_method %>
      <%= f.hidden_field :total_payment %>
      <%= f.submit "注文を確定する", class: "btn btn-success" %>
    <% end %>
  </div>
    <% else %>
      <!-- if カートアイテムがない時 -->
      <p>お客様のショッピングカートに商品はありませんので注文確定ができません。</p>
      <p><%= link_to "商品一覧", items_path %>から商品をお探し下さい。</p>
    <% end %>
  </div>

</div>